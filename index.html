<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Phone Orders</title>
  
<link rel="apple-touch-icon" href="apple-touch-icon.png">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & Babel (single-file dev) -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.5/babel.min.js"></script>
  
  <!-- jsPDF (for PDF receipts) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <style>
    .fade-down { animation: fadeDown .45s ease-out forwards; }
    @keyframes fadeDown { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(18px); } }
    .slide-up { animation: slideUp .45s ease-out forwards; }
    @keyframes slideUp { from { transform: translateY(0); } to { transform: translateY(-100%); } }
    .fade-in { animation: fadeIn .28s ease-in forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .scale-transition { transition: transform .18s ease; }
    .scale-transition:hover { transform: scale(1.04); }
    .card-shadow { box-shadow: 0 8px 18px -8px rgba(0,0,0,0.35); }
    .max-w-xl { max-width: 36rem; }
    .max-w-3xl { max-width: 48rem; }
    .filter-badge { padding: .15rem .5rem; border-radius: .45rem; font-size: .8rem; }
    /* small monospace in receipts */
    .receipt-mono { font-family: monospace; white-space: pre-wrap; }
  </style>
</head>
<body class="dark bg-gradient-to-br from-slate-800 to-slate-700 min-h-screen">

<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo } = React;

/* ---------- Helpers ---------- */
const formatCurrency = (pence) => '£' + (pence/100).toFixed(2);
const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2,8);

/* ---------- Format helpers ---------- */
const formatAddress = (str = '') =>
  str
    .trim()
    .toLowerCase()
    .split(' ')
    .filter(Boolean)
    .map(w => w[0].toUpperCase() + w.slice(1))
    .join(' ');

const formatPostcode = (str = '') =>
  str
    .toUpperCase()
    .replace(/\s+/g, '')
    .replace(/^([A-Z0-9]{2,4})([A-Z0-9]{3})$/, '$1 $2')
    .trim();

const formatPhone = (str = '') =>
  str
    .replace(/\D/g, '')
    .replace(/^0/, '0 ')
    .replace(/(\d{4})(?=\d)/g, '$1 ')
    .trim();


// --- Delivery charge constant (always applied for delivery orders) ---
const DELIVERY_CHARGE_PENCE = 300; // £3.00

/* ---------- PRODUCTS with options (Fish category with Salt & Vinegar fixed) ---------- */
const PRODUCTS = [
  {
  id: 'cod_chips',
  name: 'Fillet of Cod & Chips',
  basePricePence: 1055,
  tags: ['fish'],
  options: [
    {
      groupId: 'crumb',
      label: 'Scottish Speciality Crumb',
      type: 'single',
      choices: [
        { id: 'no', label: 'Regular Batter', pricePence: 0 },
        { id: 'yes', label: 'Scottish Speciality Crumb', pricePence: 100 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
    {
      groupId: 'nobatter',
      label: 'No Batter',
      type: 'single',
      choices: [
        { id: 'no', label: 'Batter', pricePence: 0 },
        { id: 'yes', label: 'No Batter', pricePence: 0 },
      ],
      defaultChoice: 'no',
    },
  ],
},

  {
    id: 'cod_fillet',
    name: 'Fillet of Cod',
    basePricePence: 735,
    tags: ['fish'],
    options: [
      {
  groupId: 'crumb',
  label: 'Scottish Speciality Crumb instead of Batter',
  type: 'single',
  choices: [
    { id: 'no', label: 'No', pricePence: 0 },
    { id: 'yes', label: 'Yes', pricePence: 110 },
  ],
  defaultChoice: 'no',
},

      {
        groupId: 'add_chips',
        label: 'Add chips',
        type: 'single',
        choices: [
          { id: 'no', label: 'No', pricePence: 0 },
          { id: 'small', label: 'Small', pricePence: 255 },
          { id: 'regular', label: 'Regular', pricePence: 320 },
          { id: 'large', label: 'Large', pricePence: 445 },
        ],
        defaultChoice: 'no',
      },
      {
        groupId: 'saltvinegar',
        label: 'Salt & Vinegar',
        type: 'single',
        choices: [
          { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
          { id: 'salt', label: 'Salt only', pricePence: 0 },
          { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
          { id: 'none', label: 'None', pricePence: 0 },
        ],
        defaultChoice: 'none',
      },
      {
  groupId: 'nobatter',
  label: 'No Batter',
  type: 'single',
  choices: [
    { id: 'no', label: 'Batter', pricePence: 0 },
    { id: 'yes', label: 'No Batter', pricePence: 0 },
  ],
  defaultChoice: 'no',
},

    ],
  },
  {
    id: 'cod_fillet_small',
    name: 'Small Fillet of Cod',
    basePricePence: 615,
    tags: ['fish'],
    options: [
      {
  groupId: 'crumb',
  label: 'Scottish Speciality Crumb instead of Batter',
  type: 'single',
  choices: [
    { id: 'no', label: 'No', pricePence: 0 },
    { id: 'yes', label: 'Yes', pricePence: 110 },
  ],
  defaultChoice: 'no',
},

      {
        groupId: 'add_chips',
        label: 'Add chips',
        type: 'single',
        choices: [
          { id: 'no', label: 'No', pricePence: 0 },
          { id: 'small', label: 'Small', pricePence: 255 },
          { id: 'regular', label: 'Regular', pricePence: 320 },
          { id: 'large', label: 'Large', pricePence: 445 },
        ],
        defaultChoice: 'no',
      },
      {
        groupId: 'saltvinegar',
        label: 'Salt & Vinegar',
        type: 'single',
        choices: [
          { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
          { id: 'salt', label: 'Salt only', pricePence: 0 },
          { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
          { id: 'none', label: 'None', pricePence: 0 },
        ],
        defaultChoice: 'none',
      },
      {
  groupId: 'nobatter',
  label: 'No Batter',
  type: 'single',
  choices: [
    { id: 'no', label: 'Batter', pricePence: 0 },
    { id: 'yes', label: 'No Batter', pricePence: 0 },
  ],
  defaultChoice: 'no',
},

    ],
  },
  {
    id: 'cod_fillet_large',
    name: 'Large Fillet of Cod',
    basePricePence: 975,
    tags: ['fish'],
    options: [
      {
  groupId: 'crumb',
  label: 'Scottish Speciality Crumb instead of Batter',
  type: 'single',
  choices: [
    { id: 'no', label: 'No', pricePence: 0 },
    { id: 'yes', label: 'Yes', pricePence: 110 },
  ],
  defaultChoice: 'no',
},

      {
        groupId: 'add_chips',
        label: 'Add chips',
        type: 'single',
        choices: [
          { id: 'no', label: 'No', pricePence: 0 },
          { id: 'small', label: 'Small', pricePence: 255 },
          { id: 'regular', label: 'Regular', pricePence: 320 },
          { id: 'large', label: 'Large', pricePence: 445 },
        ],
        defaultChoice: 'no',
      },
      {
        groupId: 'saltvinegar',
        label: 'Salt & Vinegar',
        type: 'single',
        choices: [
          { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
          { id: 'salt', label: 'Salt only', pricePence: 0 },
          { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
          { id: 'none', label: 'None', pricePence: 0 },
        ],
        defaultChoice: 'none',
      },
      {
  groupId: 'nobatter',
  label: 'No Batter',
  type: 'single',
  choices: [
    { id: 'no', label: 'Batter', pricePence: 0 },
    { id: 'yes', label: 'No Batter', pricePence: 0 },
  ],
  defaultChoice: 'no',
},

    ],
  },
  {
    id: 'haddock_large',
    name: 'Large Fillet of Haddock',
    basePricePence: 870,
    tags: ['fish'],
    options: [
      {
  groupId: 'crumb',
  label: 'Scottish Speciality Crumb instead of Batter',
  type: 'single',
  choices: [
    { id: 'no', label: 'No', pricePence: 0 },
    { id: 'yes', label: 'Yes', pricePence: 110 },
  ],
  defaultChoice: 'no',
},

      {
        groupId: 'add_chips',
        label: 'Add chips',
        type: 'single',
        choices: [
          { id: 'no', label: 'No', pricePence: 0 },
          { id: 'small', label: 'Small', pricePence: 255 },
          { id: 'regular', label: 'Regular', pricePence: 320 },
          { id: 'large', label: 'Large', pricePence: 445 },
        ],
        defaultChoice: 'no',
      },
      {
        groupId: 'saltvinegar',
        label: 'Salt & Vinegar',
        type: 'single',
        choices: [
          { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
          { id: 'salt', label: 'Salt only', pricePence: 0 },
          { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
          { id: 'none', label: 'None', pricePence: 0 },
        ],
        defaultChoice: 'none',
      },
    ],
  },
  {
    id: 'scampi',
    name: 'Whitby Wholetail Scampi',
    basePricePence: 490,
    tags: ['fish'],
    options: [
      {
        groupId: 'portion',
        label: 'Portion size',
        type: 'single',
        choices: [
          { id: '6pc', label: '6 Pieces', pricePence: 490 },
          { id: '10pc', label: '10 Pieces', pricePence: 700 },
        ],
        defaultChoice: '6pc',
      },
      {
        groupId: 'add_chips',
        label: 'Add chips',
        type: 'single',
        choices: [
          { id: 'no', label: 'No', pricePence: 0 },
          { id: 'small', label: 'Small', pricePence: 255 },
          { id: 'regular', label: 'Regular', pricePence: 320 },
          { id: 'large', label: 'Large', pricePence: 445 },
        ],
        defaultChoice: 'no',
      },
      {
        groupId: 'saltvinegar',
        label: 'Salt & Vinegar',
        type: 'single',
        choices: [
          { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
          { id: 'salt', label: 'Salt only', pricePence: 0 },
          { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
          { id: 'none', label: 'None', pricePence: 0 },
        ],
        defaultChoice: 'none',
      },
    ],
  },
  {
      id: 'two_gates_bites',
  name: 'Two Gates Cod Fish Bites',
  basePricePence: 540,
  tags: ['fish'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small', pricePence: 540 },
        { id: 'large', label: 'Large', pricePence: 740 },
      ],
      defaultChoice: 'small',
    },
    {
      groupId: 'add_chips',
      label: 'Add chips',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small', pricePence: 255 },
        { id: 'regular', label: 'Regular', pricePence: 320 },
        { id: 'large', label: 'Large', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
    {
      groupId: 'nobatter',
      label: 'No Batter',
      type: 'single',
      choices: [
        { id: 'no', label: 'Batter', pricePence: 0 },
        { id: 'yes', label: 'No Batter', pricePence: 0 },
      ],
      defaultChoice: 'no',
    },
  ],
},
{
  id: 'woof',
  name: 'Woof',
  basePricePence: 660,
  tags: ['fish'],
  options: [
    {
      groupId: 'crumb',
      label: 'Scottish Speciality Crumb instead of Batter',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'yes', label: 'Yes', pricePence: 100 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'add_chips',
      label: 'Add chips',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small', pricePence: 240 },
        { id: 'regular', label: 'Regular', pricePence: 300 },
        { id: 'large', label: 'Large', pricePence: 420 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
    {
      groupId: 'nobatter',
      label: 'No Batter',
      type: 'single',
      choices: [
        { id: 'no', label: 'Batter', pricePence: 0 },
        { id: 'yes', label: 'No Batter', pricePence: 0 },
      ],
      defaultChoice: 'no',
    },
  ],
},

{
  id: 'haddock',
  name: 'Haddock',
  basePricePence: 660,
  tags: ['fish'],
  options: [
    {
      groupId: 'crumb',
      label: 'Scottish Speciality Crumb instead of Batter',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'yes', label: 'Yes', pricePence: 100 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'add_chips',
      label: 'Add chips',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small', pricePence: 240 },
        { id: 'regular', label: 'Regular', pricePence: 300 },
        { id: 'large', label: 'Large', pricePence: 420 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
    {
      groupId: 'nobatter',
      label: 'No Batter',
      type: 'single',
      choices: [
        { id: 'no', label: 'Batter', pricePence: 0 },
        { id: 'yes', label: 'No Batter', pricePence: 0 },
      ],
      defaultChoice: 'no',
    },
  ],
},


/* ---------- CHIPS SECTION ---------- */
{
  id: 'chips_small',
  name: 'Small Chips',
  basePricePence: 255,
  tags: ['chips'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'chips_regular',
  name: 'Regular Chips',
  basePricePence: 320,
  tags: ['chips'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
    id: 'chips_large',
  name: 'Large Chips',
  basePricePence: 445,
  tags: ['chips'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},
/* ---------- END CHIPS SECTION ---------- */

/* ---------- SAUSAGES SECTION ---------- */
{
  id: 'plain_sausage',
  name: 'Chip Shop Plain Sausage',
  basePricePence: 230,
  tags: ['sausages'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small', pricePence: 230 },
        { id: 'large', label: 'Large', pricePence: 280 },
      ],
      defaultChoice: 'small',
    },
    {
      groupId: 'add_chips',
      label: 'Add chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'battered_sausage',
  name: 'Chip Shop Battered Sausage',
  basePricePence: 230,
  tags: ['sausages'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small', pricePence: 230 },
        { id: 'large', label: 'Large', pricePence: 280 },
      ],
      defaultChoice: 'small',
    },
    {
      groupId: 'add_chips',
      label: 'Add chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'haggis_sausage',
  name: 'Haggis Sausage',
  basePricePence: 365,
  tags: ['sausages'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'bigfoot_plain_sausage',
  name: 'Big Foot Sausage (Plain)',
  basePricePence: 365,
  tags: ['sausages'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'bigfoot_battered_sausage',
  name: 'Big Foot Sausage (Battered)',
  basePricePence: 365,
  tags: ['sausages'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
        groupId: 'saltvinegar',
  label: 'Salt & Vinegar',
  type: 'single',
  choices: [
    { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
    { id: 'salt', label: 'Salt only', pricePence: 0 },
    { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
    { id: 'none', label: 'None', pricePence: 0 },
  ],
  defaultChoice: 'none',
},
],
},
/* ---------- END SAUSAGES SECTION ---------- */

/* ---------- CHICKEN SECTION ---------- */
{
  id: 'chicken_nuggets',
  name: 'Chicken Nuggets',
  basePricePence: 380,
  tags: ['chicken'],
  options: [
    {
      groupId: 'portion',
      label: 'Portion Size',
      type: 'single',
      choices: [
        { id: '6pc', label: '6 Pieces (£3.80)', pricePence: 0 },
        { id: '10pc', label: '10 Pieces (£5.85)', pricePence: 205 },
      ],
      defaultChoice: '6pc',
    },
    {
      groupId: 'add_chips',
      label: 'Add chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'southern_fried_chicken',
  name: 'Southern Fried Chicken',
  basePricePence: 315,
  tags: ['chicken'],
  options: [
    {
      groupId: 'pieces',
      label: 'Portion Size',
      type: 'single',
      choices: [
        { id: '3pc', label: '3 Pieces (£3.15)', pricePence: 0 },
        { id: '5pc', label: '5 Pieces (£4.45)', pricePence: 130 },
      ],
      defaultChoice: '3pc',
    },
    {
      groupId: 'add_chips',
      label: 'Add chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},
/* ---------- END CHICKEN SECTION ---------- */


/* ---------- EXTRAS SECTION ---------- */
{
  id: 'onion_rings',
  name: 'Homemade Onion Rings',
  basePricePence: 330,
  tags: ['extras'],
},

{
  id: 'cheese_onion_fryit',
  name: 'Cheese & Onion Fry-It',
  basePricePence: 205,
  tags: ['extras'],
},

{
  id: 'potato_scallop',
  name: 'Potato Scallop',
  basePricePence: 105,
  tags: ['extras'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'spam_fritter',
  name: 'Spam Fritter',
  basePricePence: 260,
  tags: ['extras'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'chip_butty',
  name: 'Chip Butty',
  basePricePence: 420,
  tags: ['extras'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},{
  id: 'fresh_bread_cake',
  name: 'Fresh Bread Cake',
  basePricePence: 120,
  tags: ['extras'],
},
/* ---------- END EXTRAS SECTION ---------- */

/* ---------- SIDES SECTION ---------- */
{
  id: 'mushy_peas',
  name: 'Mushy Peas',
  basePricePence: 160,
  tags: ['sides'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£1.60)', pricePence: 0 },
        { id: 'large', label: 'Large (£1.80)', pricePence: 20 },
      ],
      defaultChoice: 'small',
    },
  ],
},

{
  id: 'heinz_beans',
  name: 'Heinz Beans',
  basePricePence: 160,
  tags: ['sides'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£1.60)', pricePence: 0 },
        { id: 'large', label: 'Large (£1.80)', pricePence: 20 },
      ],
      defaultChoice: 'small',
    },
  ],
},

{
  id: 'spicy_irish_curry',
  name: 'Spicy Irish Curry',
  basePricePence: 160,
  tags: ['sides'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£1.60)', pricePence: 0 },
        { id: 'large', label: 'Large (£1.80)', pricePence: 20 },
      ],
      defaultChoice: 'small',
    },
  ],
},

{
  id: 'gravy',
  name: 'Gravy',
  basePricePence: 160,
  tags: ['sides'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£1.60)', pricePence: 0 },
        { id: 'large', label: 'Large (£1.80)', pricePence: 20 },
      ],
      defaultChoice: 'small',
    },
  ],
},

{
  id: 'chip_shop_curry',
  name: 'Chip Shop Curry',
  basePricePence: 160,
  tags: ['sides'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£1.60)', pricePence: 0 },
        { id: 'large', label: 'Large (£1.80)', pricePence: 20 },
      ],
      defaultChoice: 'small',
    },
  ],
},
/* ---------- END SIDES SECTION ---------- */


/* ---------- LITE BITES SECTION ---------- */
{
  id: 'small_fish_lite_bite',
  name: 'Small Fish Lite Bite',
  basePricePence: 950,
  tags: ['litebites'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'fishcake_lite_bite',
  name: 'Fishcake Lite Bite',
  basePricePence: 595,
  tags: ['litebites'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'fish_bites_lite_bite',
  name: '4 x Fish Bites Lite Bite',
  basePricePence: 700,
  tags: ['litebites'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cheese_onion_fryit_lite_bite',
  name: 'Cheese & Onion Fry-It Lite Bite',
  basePricePence: 595,
  tags: ['litebites'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'turnover_lite_bite',
  name: 'Homemade Turnover Lite Bite',
  basePricePence: 690,
  tags: ['litebites'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'scampi_lite_bite',
  name: 'Whitby Wholetail Scampi Lite Bite',
  basePricePence: 715,
  tags: ['litebites'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},
/* ---------- END LITE BITES SECTION ---------- */


/* ---------- DRINKS SECTION ---------- */
{
  id: 'ben_shaws_cloudy_lemonade',
  name: "Ben & Shaws Cloudy Lemonade",
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'ben_shaws_bitter_shandy',
  name: "Ben & Shaws Bitter Shandy",
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'ben_shaws_dandelion_burdock',
  name: "Ben & Shaws Dandelion & Burdock",
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'coke',
  name: 'Coke',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'diet_coke',
  name: 'Diet Coke',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'dr_pepper',
  name: 'Dr Pepper',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'fanta_orange',
  name: 'Fanta Orange',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'fanta_pineapple',
  name: 'Fanta Pineapple',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'fanta_lemon',
  name: 'Fanta Lemon',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'irn_bru',
  name: 'Irn Bru',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'tango_mango',
  name: 'Tango Mango',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'tango_blackberry',
  name: 'Tango Blackberry',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'tango_apple',
  name: 'Tango Apple',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'tango_orange',
  name: 'Tango Orange',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'vimto',
  name: 'Vimto',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'pepsi',
  name: 'Pepsi',
  basePricePence: 130,
  tags: ['drinks'],
},
{
  id: 'monster_punch',
  name: 'Monster Punch',
  basePricePence: 200,
  tags: ['drinks'],
},
{
  id: 'water',
  name: 'Water',
  basePricePence: 130,
  tags: ['drinks'],
},
/* ---------- END DRINKS SECTION ---------- */

/* ---------- CHILDREN'S MEALS SECTION ---------- */
{
  id: 'kids_plain_sausage_meal',
  name: "Kids Small Sausage Meal (Plain)",
  basePricePence: 550,
  tags: ['children'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
    {
      groupId: 'cup_drink',
      label: 'Choose Cup Drink',
      type: 'single',
      choices: [
        { id: 'orange', label: 'Orange', pricePence: 0 },
        { id: 'raspberry', label: 'Raspberry', pricePence: 0 },
        { id: 'bubblegum', label: 'Bubblegum', pricePence: 0 },
      ],
      defaultChoice: 'orange',
    },
  ],
},

{
  id: 'kids_battered_sausage_meal',
  name: "Kids Small Sausage Meal (Battered)",
  basePricePence: 550,
  tags: ['children'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
    {
      groupId: 'cup_drink',
      label: 'Choose Cup Drink',
      type: 'single',
      choices: [
        { id: 'orange', label: 'Orange', pricePence: 0 },
        { id: 'raspberry', label: 'Raspberry', pricePence: 0 },
        { id: 'bubblegum', label: 'Bubblegum', pricePence: 0 },
      ],
      defaultChoice: 'orange',
    },
  ],
},

{
  id: 'kids_fish_bites_meal',
  name: "Kids 4 Fish Bites Meal",
  basePricePence: 550,
  tags: ['children'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
    {
      groupId: 'cup_drink',
      label: 'Choose Cup Drink',
      type: 'single',
      choices: [
        { id: 'orange', label: 'Orange', pricePence: 0 },
        { id: 'raspberry', label: 'Raspberry', pricePence: 0 },
        { id: 'bubblegum', label: 'Bubblegum', pricePence: 0 },
      ],
      defaultChoice: 'orange',
    },
  ],
},

{
  id: 'kids_fishcake_meal',
  name: "Kids Fish Cake Meal",
  basePricePence: 550,
  tags: ['children'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
    {
      groupId: 'cup_drink',
      label: 'Choose Cup Drink',
      type: 'single',
      choices: [
        { id: 'orange', label: 'Orange', pricePence: 0 },
        { id: 'raspberry', label: 'Raspberry', pricePence: 0 },
        { id: 'bubblegum', label: 'Bubblegum', pricePence: 0 },
      ],
      defaultChoice: 'orange',
    },
  ],
},

{
  id: 'kids_chicken_nuggets_meal',
  name: "Kids 4 Chicken Nuggets Meal",
  basePricePence: 550,
  tags: ['children'],
  options: [
    {
      groupId: 'side_choice',
      label: 'Choose your side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Mushy Peas', pricePence: 0 },
        { id: 'gravy', label: 'Gravy', pricePence: 0 },
        { id: 'curry', label: 'Curry', pricePence: 0 },
        { id: 'chipshop_curry', label: 'Chip Shop Curry', pricePence: 0 },
        { id: 'beans', label: 'Heinz Beans', pricePence: 0 },
      ],
      defaultChoice: 'peas',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
    {
      groupId: 'cup_drink',
      label: 'Choose Cup Drink',
      type: 'single',
      choices: [
        { id: 'orange', label: 'Orange', pricePence: 0 },
        { id: 'raspberry', label: 'Raspberry', pricePence: 0 },
        { id: 'bubblegum', label: 'Bubblegum', pricePence: 0 },
      ],
      defaultChoice: 'orange',
    },
  ],
},
/* ---------- END CHILDREN'S MEALS SECTION ---------- */

/* ---------- PIES SECTION ---------- */
{
  id: 'cannonhall_steak_pie',
  name: 'Cannon Hall Steak Pie',
  basePricePence: 550,
  tags: ['pies'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add Chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cannonhall_mince_ale_pie',
  name: 'Cannon Hall Mince & Ale Pie',
  basePricePence: 550,
  tags: ['pies'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add Chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cannonhall_meat_potato_pie',
  name: 'Cannon Hall Meat & Potato Pie',
  basePricePence: 550,
  tags: ['pies'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add Chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cannonhall_chicken_mushroom_pie',
  name: 'Cannon Hall Chicken & Mushroom Pie',
  basePricePence: 550,
  tags: ['pies'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add Chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cannonhall_steak_mushroom_guinness_pie',
  name: 'Cannon Hall Steak, Mushroom & Guinness Pie',
  basePricePence: 550,
  tags: ['pies'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add Chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cannonhall_steak_kidney_pie',
  name: 'Cannon Hall Steak & Kidney Pie',
  basePricePence: 550,
  tags: ['pies'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add Chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

/* Cannon Hall Pie Deals */
{
  id: 'cannonhall_steak_pie_deal',
  name: 'Cannon Hall Steak Pie Deal (with Peas, Chips & Gravy)',
  basePricePence: 1055,
  tags: ['pies'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cannonhall_chicken_mushroom_pie_deal',
  name: 'Cannon Hall Chicken & Mushroom Pie Deal (with Peas, Chips & Gravy)',
  basePricePence: 1055,
  tags: ['pies'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cannonhall_steak_kidney_pie_deal',
  name: 'Cannon Hall Steak & Kidney Pie Deal (with Peas, Chips & Gravy)',
  basePricePence: 1055,
  tags: ['pies'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cannonhall_mince_ale_pie_deal',
  name: 'Cannon Hall Mince & Ale Pie Deal (with Peas, Chips & Gravy)',
  basePricePence: 1055,
  tags: ['pies'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cannonhall_meat_potato_pie_deal',
  name: 'Cannon Hall Meat & Potato Pie Deal (with Peas, Chips & Gravy)',
  basePricePence: 1055,
  tags: ['pies'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'cannonhall_steak_mushroom_guinness_pie_deal',
  name: 'Cannon Hall Steak, Mushroom & Guinness Pie Deal (with Peas, Chips & Gravy)',
  basePricePence: 1055,
  tags: ['pies'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

/* Potters Pies */
{
  id: 'potters_steak_pie',
  name: 'Potters Steak Pie',
  basePricePence: 370,
  tags: ['pies'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add Chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'potters_chicken_mushroom_pie',
  name: 'Potters Chicken & Mushroom Pie',
  basePricePence: 370,
  tags: ['pies'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add Chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'potters_minced_beef_onion_pie',
  name: 'Potters Minced Beef & Onion Pie',
  basePricePence: 370,
  tags: ['pies'],
  options: [
    {
      groupId: 'add_chips',
      label: 'Add Chips?',
      type: 'single',
      choices: [
        { id: 'no', label: 'No', pricePence: 0 },
        { id: 'small', label: 'Small (+£2.55)', pricePence: 255 },
        { id: 'regular', label: 'Regular (+£3.20)', pricePence: 320 },
        { id: 'large', label: 'Large (+£4.45)', pricePence: 445 },
      ],
      defaultChoice: 'no',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar', pricePence: 0 },
        { id: 'salt', label: 'Salt only', pricePence: 0 },
        { id: 'vinegar', label: 'Vinegar only', pricePence: 0 },
        { id: 'none', label: 'None', pricePence: 0 },
      ],
      defaultChoice: 'none',
    },
  ],
},
/* ---------- END PIES SECTION ---------- */

/* ---------- GLUTEN FREE SECTION ---------- */

/* Gluten Free Fish */
{
  id: 'gf_beans',
  name: 'GF Beans',
  basePricePence: 160,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£1.60)', pricePence: 0 },
        { id: 'large', label: 'Large (£1.80)', pricePence: 20 },
      ],
      defaultChoice: 'small',
    },
  ],
},

{
  id: 'gf_cod',
  name: 'GF Cod',
  basePricePence: 660,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£6.60)', pricePence: 0 },
        { id: 'large', label: 'Large (£10.20)', pricePence: 360 },
      ],
      defaultChoice: 'small',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar' },
        { id: 'salt', label: 'Salt only' },
        { id: 'vinegar', label: 'Vinegar only' },
        { id: 'none', label: 'None' },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'gf_haddock',
  name: 'GF Haddock',
  basePricePence: 740,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£7.40)', pricePence: 0 },
        { id: 'large', label: 'Large (£9.75)', pricePence: 235 },
      ],
      defaultChoice: 'small',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar' },
        { id: 'salt', label: 'Salt only' },
        { id: 'vinegar', label: 'Vinegar only' },
        { id: 'none', label: 'None' },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'gf_woof',
  name: 'GF Woof',
  basePricePence: 795,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar' },
        { id: 'salt', label: 'Salt only' },
        { id: 'vinegar', label: 'Vinegar only' },
        { id: 'none', label: 'None' },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'gf_turnover',
  name: 'GF Turnover',
  basePricePence: 405,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar' },
        { id: 'salt', label: 'Salt only' },
        { id: 'vinegar', label: 'Vinegar only' },
        { id: 'none', label: 'None' },
      ],
      defaultChoice: 'none',
    },
  ],
},

{
  id: 'gf_fish_bites',
  name: 'GF Fish Bites',
  basePricePence: 585,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£5.85)', pricePence: 0 },
        { id: 'large', label: 'Large (£7.85)', pricePence: 200 },
      ],
      defaultChoice: 'small',
    },
    {
      groupId: 'saltvinegar',
      label: 'Salt & Vinegar',
      type: 'single',
      choices: [
        { id: 'sv', label: 'Salt & Vinegar' },
        { id: 'salt', label: 'Salt only' },
        { id: 'vinegar', label: 'Vinegar only' },
        { id: 'none', label: 'None' },
      ],
      defaultChoice: 'none',
    },
  ],
},

/* Gluten Free Chips */
{
  id: 'gf_chips',
  name: 'GF Chips',
  basePricePence: 255,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£2.55)', pricePence: 0 },
        { id: 'regular', label: 'Regular (£3.20)', pricePence: 65 },
        { id: 'large', label: 'Large (£4.45)', pricePence: 190 },
      ],
      defaultChoice: 'regular',
    },
  ],
},

/* Gluten Free Sausages */
{
  id: 'gf_large_sausage',
  name: 'GF Large Sausage',
  basePricePence: 315,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'type',
      label: 'Type',
      type: 'single',
      choices: [
        { id: 'plain', label: 'Plain' },
        { id: 'battered', label: 'Battered' },
      ],
      defaultChoice: 'plain',
    },
  ],
},

/* Gluten Free Lite Bites */
{
  id: 'gf_litebite_fish',
  name: 'GF Lite Bite Fish',
  basePricePence: 990,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'gf_side',
      label: 'GF Side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Peas' },
        { id: 'beans', label: 'Beans' },
        { id: 'gravy', label: 'Gravy' },
      ],
      defaultChoice: 'peas',
    },
  ],
},

{
  id: 'gf_litebite_large_sausage',
  name: 'GF Lite Bite Large Sausage',
  basePricePence: 720,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'type',
      label: 'Type',
      type: 'single',
      choices: [
        { id: 'plain', label: 'Plain' },
        { id: 'battered', label: 'Battered' },
      ],
      defaultChoice: 'plain',
    },
    {
      groupId: 'gf_side',
      label: 'GF Side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Peas' },
        { id: 'beans', label: 'Beans' },
        { id: 'gravy', label: 'Gravy' },
      ],
      defaultChoice: 'peas',
    },
  ],
},

{
  id: 'gf_litebite_spam_fritter',
  name: 'GF Lite Bite Large Spam Fritter',
  basePricePence: 675,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'gf_side',
      label: 'GF Side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Peas' },
        { id: 'beans', label: 'Beans' },
        { id: 'gravy', label: 'Gravy' },
      ],
      defaultChoice: 'peas',
    },
  ],
},

{
  id: 'gf_litebite_turnover',
  name: 'GF Lite Bite Turnover',
  basePricePence: 780,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'gf_side',
      label: 'GF Side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Peas' },
        { id: 'beans', label: 'Beans' },
        { id: 'gravy', label: 'Gravy' },
      ],
      defaultChoice: 'peas',
    },
  ],
},

{
  id: 'gf_litebite_fish_bites',
  name: 'GF Lite Bite 4 x Fish Bites',
  basePricePence: 740,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'gf_side',
      label: 'GF Side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Peas' },
        { id: 'beans', label: 'Beans' },
        { id: 'gravy', label: 'Gravy' },
      ],
      defaultChoice: 'peas',
    },
  ],
},

/* Gluten Free Extras */
{
  id: 'gf_gravy',
  name: 'GF Gravy',
  basePricePence: 145,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£1.45)', pricePence: 0 },
        { id: 'large', label: 'Large (£1.65)', pricePence: 20 },
      ],
      defaultChoice: 'small',
    },
  ],
},

{
  id: 'gf_peas',
  name: 'GF Peas',
  basePricePence: 145,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'size',
      label: 'Size',
      type: 'single',
      choices: [
        { id: 'small', label: 'Small (£1.45)', pricePence: 0 },
        { id: 'large', label: 'Large (£1.65)', pricePence: 20 },
      ],
      defaultChoice: 'small',
    },
  ],
},

{
  id: 'gf_onion_rings',
  name: 'GF Onion Rings',
  basePricePence: 370,
  tags: ['glutenfree'],
},

{
  id: 'gf_potato_scallop',
  name: 'GF Potato Scallop',
  basePricePence: 150,
  tags: ['glutenfree'],
},

{
  id: 'gf_spam_fritter',
  name: 'GF Spam Fritter',
  basePricePence: 300,
  tags: ['glutenfree'],
},

/* Gluten Free Kids */
{
  id: 'gf_kids_fish_bites',
  name: 'GF Kids 4 x Fish Bites',
  basePricePence: 570,
  tags: ['glutenfree'],
  options: [
    {
      groupId: 'gf_side',
      label: 'GF Side',
      type: 'single',
      choices: [
        { id: 'peas', label: 'Peas' },
        { id: 'beans', label: 'Beans' },
        { id: 'gravy', label: 'Gravy' },
      ],
      defaultChoice: 'peas',
    },
  ],
},
/* ---------- END GLUTEN FREE SECTION ---------- */


];

/* ---------- Local Storage Keys ---------- */
const LS = {
  ORDERS: 'phone_orders_v6',
  THEME: 'phone_orders_theme_v6',
  PRODUCTS: 'phone_orders_products_v6',
};




/* ---------- Storage helpers ---------- */
const load = (key, fallback) => {
  try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; } catch(e) { return fallback; }
};
const save = (key, data) => { try { localStorage.setItem(key, JSON.stringify(data)); } catch(e){} };

/* ---------- UI components ---------- */
function Toast({ open, text, actionLabel, onAction }) {
  if (!open) return null;
  return (
    <div className="fixed bottom-8 left-1/2 -translate-x-1/2 z-50">
      <div className="px-4 py-3 rounded-xl card-shadow bg-slate-800 text-slate-100 flex items-center gap-4">
        <div>{text}</div>
        {onAction && <button onClick={onAction} className="px-3 py-1 rounded bg-slate-700 text-sm">{actionLabel || 'Undo'}</button>}
      </div>
    </div>
  );
}

function Modal({ open, title, onClose, children, wide=false }) {
  if (!open) return null;
  return (
    <div className="fixed inset-0 bg-black/50 z-40 flex items-center justify-center p-4">
      <div className={`bg-white dark:bg-slate-800 rounded-2xl overflow-hidden w-full ${wide ? 'max-w-3xl' : 'max-w-xl'} card-shadow`}>
        <div className="px-5 py-3 border-b border-slate-200/10 flex justify-between items-center">
          <h3 className="font-semibold text-slate-900 dark:text-slate-100">{title}</h3>
          <button onClick={onClose} className="text-slate-500 hover:text-slate-300"><i className="fas fa-times"></i></button>
        </div>
        <div className="p-5 text-slate-900 dark:text-slate-100">{children}</div>
      </div>
    </div>
  );
}

/* ---------- Main App (mostly unchanged) ---------- */
function App() {
  /* theme */
  const [isDark, setIsDark] = useState(() => load(LS.THEME, true));
  useEffect(()=>{ save(LS.THEME, isDark); document.body.className = isDark ? 'dark bg-gradient-to-br from-slate-800 to-slate-700 min-h-screen' : 'bg-[#f1f2f4] min-h-screen'; }, [isDark]);

  /* products */
  const [products, setProducts] = useState(() => load(LS.PRODUCTS, PRODUCTS));
  useEffect(()=> save(LS.PRODUCTS, products), [products]);

  /* orders */
  const [orders, setOrders] = useState(() => load(LS.ORDERS, []));
  useEffect(()=> save(LS.ORDERS, orders), [orders]);

  /* active order */
  const [orderType, setOrderType] = useState(null); // 'collection' or 'delivery'
  const [orderItems, setOrderItems] = useState([]);
  const [orderTime, setOrderTime] = useState(''); // "HH:MM"
  const [customer, setCustomer] = useState({ name:'', address:'', postcode:'', phone:'' });
  const [step, setStep] = useState(1);

  /* editing */
  const [editingOrderId, setEditingOrderId] = useState(null);
  const [editingPart, setEditingPart] = useState(null); // 'items' | 'time' | 'customer'
  const [editingBannerCustomer, setEditingBannerCustomer] = useState('');

  /* UI */
  const [showItemModal, setShowItemModal] = useState(null);
  const [toast, setToast] = useState({ open:false, text:'', action:null });
  const [search, setSearch] = useState('');
  const [filterPanelOpen, setFilterPanelOpen] = useState(false);
  const [selectedTags, setSelectedTags] = useState([]);
  const [showCompleted, setShowCompleted] = useState(false);
  const [resetModalOpen, setResetModalOpen] = useState(false);

  /* new-order confirmation modal */
  const [newOrderConfirmOpen, setNewOrderConfirmOpen] = useState(false);
  const [pendingNewType, setPendingNewType] = useState(null); // temp store type when modal shows

  /* edit-choice modal */
  const [editChoiceModalOpen, setEditChoiceModalOpen] = useState(false);
  const [viewModalOpen, setViewModalOpen] = useState(false);
  const [viewingOrder, setViewingOrder] = useState(null);


  /* derived totals */
  const totalItems = useMemo(()=> orderItems.reduce((s,i)=>s + i.qty, 0), [orderItems]);
  // --- Grand total includes £3 delivery charge when applicable ---
  const grandTotalPence = useMemo(() => {
    let total = orderItems.reduce((s, i) => s + i.qty * i.pricePence, 0);
    if (orderType === 'delivery') total += DELIVERY_CHARGE_PENCE;
    return total;
  }, [orderItems, orderType]);


  /* helpers */
  const showToast = (text, action=null) => {
    setToast({ open:true, text, action });
    if (!action) setTimeout(()=> setToast({ open:false, text:'', action:null }), 3500);
  };

  /* product filters */
  const toggleTag = (tag) => setSelectedTags(prev => prev.includes(tag) ? prev.filter(t=>t!==tag) : [...prev, tag]);
  const clearFilters = () => setSelectedTags([]);

  const filteredProducts = useMemo(()=> {
    const q = search.trim().toLowerCase();
    return products.filter(p => {
      const qMatch = !q || p.name.toLowerCase().includes(q);
      const tagMatch = selectedTags.length === 0 || (p.tags || []).some(t => selectedTags.includes(t));
      return qMatch && tagMatch;
    });
  }, [products, search, selectedTags]);

  /* item ops */
  const addOrUpdateItem = (product, qty, selectedOptions=[]) => {
    if (!product || qty <= 0) return;
    // compute per-unit price (base + option adjustments)
    const optionsSum = (selectedOptions || []).reduce((s, o) => s + (o.pricePence || 0), 0);
    const unitPrice = (product.basePricePence || product.pricePence || 0) + optionsSum;

    setOrderItems(prev => {
      const id = uid();
      // Always add new line for now (simpler for different options). If you want merging same prod+options, implement deep comparison.
      const item = {
        id,
        productId: product.id,
        name: product.name,
        basePricePence: product.basePricePence || product.pricePence,
        pricePence: unitPrice,
        qty,
        options: selectedOptions // array of {groupId, label, choiceLabel, pricePence}
      };
      return [...prev, item];
    });
    showToast(`${product.name} added x${qty}`);
  };

  const updateQty = (itemId, qty) => {
    if (qty <= 0) { removeItem(itemId); return; }
    setOrderItems(prev => prev.map(i => i.id === itemId ? { ...i, qty } : i));
    showToast('Quantity updated');
  };

  const removeItem = (itemId) => {
    const prod = orderItems.find(i => i.id === itemId);
    setOrderItems(prev => prev.filter(i => i.id !== itemId));
    if (prod) showToast(`${prod.name} removed`);
  };

  const clearActiveOrder = () => {
    setOrderType(null);
    setOrderItems([]);
    setOrderTime('');
    setCustomer({ name:'', address:'', postcode:'', phone:'' });
    setEditingOrderId(null);
    setEditingPart(null);
    setEditingBannerCustomer('');
    setStep(1);
  };

  /* check if there is active unsaved order data */
  const currentOrderHasData = () => {
    if (orderItems.length > 0) return true;
    if (orderTime) return true;
    if (customer.name || customer.address || customer.postcode || customer.phone) return true;
    return false;
  };

  /* handle starting new order (with confirmation when needed) */
  const handleStartNew = (type) => {
    if (currentOrderHasData()) {
      setPendingNewType(type);
      setNewOrderConfirmOpen(true);
    } else {
      clearActiveOrder();
      setOrderType(type);
      setStep(2);
    }
  };
  const confirmStartNew = () => {
    clearActiveOrder();
    setOrderType(pendingNewType);
    setPendingNewType(null);
    setNewOrderConfirmOpen(false);
    showToast('New order started');
    setStep(2);
  };
  const cancelStartNew = () => {
    setPendingNewType(null);
    setNewOrderConfirmOpen(false);
  };

  /* saving new order (not editing) */
  const saveOrder = () => {
    // basic validations
    if (!orderTime) { showToast('Please choose a time'); return; }
    if (!customer || !customer.name || !customer.name.trim()) { showToast('Customer name required'); return; }
    if (orderType === 'delivery' && (!customer.address || !customer.address.trim() || !customer.postcode || !customer.postcode.trim())) {
      showToast('Delivery address and postcode required'); return;
    }

    // Format customer safely (fall back to trimmed values if anything goes wrong)
    let formattedCustomer;
    try {
      formattedCustomer = {
        ...customer,
        name: formatAddress(customer.name || ''),
        address: orderType === 'delivery' ? formatAddress(customer.address || '') : (customer.address || '').trim(),
        postcode: orderType === 'delivery' ? formatPostcode(customer.postcode || '') : (customer.postcode || '').trim().toUpperCase(),
        phone: formatPhone(customer.phone || ''),
      };
    } catch (e) {
      formattedCustomer = {
        name: (customer.name || '').trim(),
        address: (customer.address || '').trim(),
        postcode: (customer.postcode || '').trim().toUpperCase(),
        phone: (customer.phone || '').trim(),
      };
      console.warn('Formatting failed in saveOrder(), using trimmed values.', e);
    }

    const orderObj = {
      id: uid(),
      type: orderType,
      items: orderItems.map(i => ({ ...i })), // items include options
      time: orderTime,
      customer: formattedCustomer,
      totalPence: grandTotalPence,
      createdAt: new Date().toISOString(),
      status: 'pending'
    };

    setOrders(prev => [orderObj, ...prev]);
    showToast('Order saved');
    clearActiveOrder();
  };


  /* mark complete / reopen / delete */
  const markComplete = (id) => { setOrders(prev => prev.map(o => o.id === id ? { ...o, status:'completed' } : o)); showToast('Order marked complete'); };
  const reopenOrder = (id) => { setOrders(prev => prev.map(o => o.id === id ? { ...o, status:'pending' } : o)); showToast('Order reopened'); };
  const deleteOrder = (id) => { setOrders(prev => prev.filter(o => o.id !== id)); showToast('Order deleted'); };

  /* reset day modal */
  const confirmResetDay = () => setResetModalOpen(true);
  const doResetDay = () => { setOrders([]); setResetModalOpen(false); showToast('Day reset — all orders cleared'); };

  /* view flow - open view modal with print option */
  const beginView = (orderId) => {
    const ord = orders.find(o => o.id === orderId);
    if (!ord) { showToast('Order not found'); return; }
    setViewingOrder(ord);
    setViewModalOpen(true);
  };

  /* edit flow - open choice modal */
  const beginEdit = (orderId) => {
    const ord = orders.find(o => o.id === orderId);
    if (!ord) { showToast('Order not found'); return; }
    if (ord.status !== 'pending') { showToast('Only pending orders can be edited'); return; }
    setEditingOrderId(orderId);
    setEditChoiceModalOpen(true);
  };

  /* choose part to edit */
  const chooseEditPart = (part) => {
    const ord = orders.find(o => o.id === editingOrderId);
    if (!ord) { setEditChoiceModalOpen(false); setEditingOrderId(null); showToast('Order not found'); return; }

    // load active form with order values
    setOrderType(ord.type);
    setOrderItems(ord.items.map(i => ({ ...i })));
    setOrderTime(ord.time || '');
    setCustomer({ ...ord.customer });

    setEditingPart(part);
    setEditingBannerCustomer(ord.customer.name || '');
    // jump to the step for that part
    if (part === 'items') setStep(2);
    if (part === 'time') setStep(3);
    if (part === 'customer') setStep(4);

    setEditChoiceModalOpen(false);
    showToast(`Editing ${part} for ${ord.customer.name}`);
  };

  /* done editing - save only the edited part back to the specific order */
  const doneEditing = () => {
    if (!editingOrderId) { showToast('No order in edit mode'); return; }
    let updatedOrder = null;
    setOrders(prev => prev.map(o => {
      if (o.id !== editingOrderId) return o;
      const updated = { ...o };
      if (editingPart === 'items') {
        updated.items = orderItems.map(i => ({ ...i }));
        updated.totalPence = orderItems.reduce((s,i) => s + i.qty * i.pricePence, 0);
      } else if (editingPart === 'time') {
        if (!orderTime) { showToast('Please choose a time before finishing'); return o; }
        updated.time = orderTime;
      } else if (editingPart === 'customer') {
        if (!customer.name.trim()) { showToast('Customer name required'); return o; }
        if (o.type === 'delivery' && (!customer.address.trim() || !customer.postcode.trim())) { showToast('Address & postcode required'); return o; }
        updated.customer = { ...customer };
      }
      updatedOrder = updated;
      return updated;
    }));

    showToast(`Changes saved for ${editingBannerCustomer || 'order'}`);

    // auto-generate a PDF receipt for the updated order
    if (updatedOrder) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: [58, 140],
      });

      const leftX = 4;
      const rightX = 54;
      const maxTextWidth = 40; // width allowed for item names before wrapping
      let y = 6;
      const lineH = 3.2;

      const line = (txt, size = 6.5, bold = false, align = "left") => {
        doc.setFontSize(size);
        doc.setFont("helvetica", bold ? "bold" : "normal");
        if (align === "center") doc.text(txt, 29, y, { align: "center" });
        else doc.text(txt, leftX, y);
        y += lineH;
      };

      // ---- HEADER ----
      line("🐟 Fish & Chips Shop", 7.5, true, "center");
      line("--------------------------------", 6.5, false, "center");
      line(`Order Type: ${updatedOrder.type}`);
      line(`Time: ${updatedOrder.time}`);
      line(`Customer: ${updatedOrder.customer.name}`);
      if (updatedOrder.type === "delivery") {
        line(updatedOrder.customer.address);
        line(updatedOrder.customer.postcode);
        if (updatedOrder.customer.phone)
          line(`Phone: ${updatedOrder.customer.phone}`);
      }
      line("--------------------------------", 6.5, false, "center");

      // ---- ITEMS (with wrapping + right-aligned prices) ----
      updatedOrder.items.forEach((it) => {
        const nameQty = `${it.name} x${it.qty}`;
        const price = `£${((it.pricePence * it.qty) / 100).toFixed(2)}`;

        doc.setFontSize(6.2);
        doc.setFont("helvetica", "normal");

        // Split long names to fit roll width
        const wrapped = doc.splitTextToSize(nameQty, maxTextWidth);

        // Print all but last line normally
        wrapped.forEach((t, idx) => {
          if (idx < wrapped.length - 1) {
            doc.text(t, leftX, y);
            y += lineH;
          } else {
            // last line gets the price on the same line
            doc.text(t, leftX, y);
            doc.text(price, rightX, y, { align: "right" });
            y += lineH;
          }
        });

        // print options (each on its own small line)
        if (it.options && it.options.length) {
          it.options.forEach(opt => {
            const optLabel = opt.choiceLabel ? `${opt.label}: ${opt.choiceLabel}` : opt.label;
            doc.setFontSize(5.5);
            doc.text(`  - ${optLabel}`, leftX, y);
            y += lineH;
          });
        }
      });

      // ---- DELIVERY CHARGE ----
      if (updatedOrder.type === "delivery") {
        const label = "Delivery Charge";
        const price = "£3.00";
        doc.text(label, leftX, y);
        doc.text(price, rightX, y, { align: "right" });
        y += lineH;
      }

      // ---- TOTAL ----
      line("--------------------------------", 6.5, false, "center");
      doc.setFontSize(7);
      doc.setFont("helvetica", "bold");
      doc.text(`Total: £${(updatedOrder.totalPence / 100).toFixed(2)}`, 29, y, {
        align: "center",
      });
      y += lineH;
      line("--------------------------------", 6.5, false, "center");
      line(new Date().toLocaleString(), 6);
      line("Thank you!", 6.5, true, "center");

      doc.save(`order_${updatedOrder.customer.name || "customer"}.pdf`);
    }

    // exit edit mode
    setEditingPart(null);
    setEditingOrderId(null);
    setEditingBannerCustomer('');
    clearActiveOrder();
  };

  /* auto-hide toast */
  useEffect(() => {
    if (toast.open && !toast.action) {
      const t = setTimeout(() => setToast({ open: false, text: '', action: null }), 3500);
      return () => clearTimeout(t);
    }
  }, [toast]);

  /* ---------- Render ---------- */
  return (
    <div className="min-h-screen pb-16">
      {/* Editing banner */}
      {editingPart && (
        <div className="w-full bg-yellow-400 text-slate-900 py-2">
          <div className="max-w-[92vw] mx-auto text-center font-semibold">
            🟡 Editing order for {editingBannerCustomer || 'customer'} — make changes, then press <span className="underline">Done Editing</span>
          </div>
        </div>
      )}


      <header className="max-w-[92vw] mx-auto pt-6">
        <div className="flex items-start justify-between gap-4">
          <div>
            <h1 className={`text-2xl md:text-3xl font-extrabold ${isDark ? 'text-white' : 'text-slate-800'}`}>Phone Orders</h1>
            <p className={`${isDark ? 'text-slate-200/80' : 'text-slate-700/80'} mt-1`}>Phone orders — collection & delivery</p>
          </div>

          <div className="flex items-center gap-2">
            <button onClick={() => setIsDark(d=>!d)} className={`w-10 h-10 rounded-full ${isDark ? 'bg-emerald-600' : 'bg-emerald-500'} text-white flex items-center justify-center scale-transition`}>
              <i className={`fas ${isDark ? 'fa-moon' : 'fa-sun'}`}></i>
            </button>
          </div>
        </div>

        <div className="mt-4 flex gap-3">
          <button onClick={() => handleStartNew('collection')}
                  className={`flex-1 py-3 rounded-xl text-white font-semibold ${orderType === 'collection' ? 'bg-emerald-500' : 'bg-emerald-600/90 hover:bg-emerald-500'} card-shadow`}>
            Collection
          </button>
          <button onClick={() => handleStartNew('delivery')}
                  className={`flex-1 py-3 rounded-xl text-white font-semibold ${orderType === 'delivery' ? 'bg-blue-500' : 'bg-blue-600/90 hover:bg-blue-500'} card-shadow`}>
            Delivery
          </button>
        </div>
      </header>

      <main className="max-w-[92vw] mx-auto mt-6 grid md:grid-cols-3 gap-6">
        {/* LEFT: Steps / form */}
        <section className="md:col-span-2 space-y-4">
          <div className={`${isDark ? 'bg-slate-800' : 'bg-white'} rounded-2xl p-4 card-shadow`}>

            <div className="flex items-center justify-between">
              <div>
                <div className={`text-sm ${isDark ? 'text-slate-300' : 'text-slate-600'}`}>Step {step} of 5</div>
                <h2 className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-slate-800'}`}>
                  {step === 1 && 'Confirm Type'}
                  {step === 2 && 'Add Items'}
                  {step === 3 && 'Choose Time'}
                  {step === 4 && 'Customer Details'}
                  {step === 5 && 'Review & Confirm'}
                </h2>
              </div>
              <div className={`text-sm ${isDark ? 'text-slate-300' : 'text-slate-600'}`}>
                Items: <span className="font-medium">{totalItems}</span> • Total: <span className="font-medium">{formatCurrency(grandTotalPence)}</span>
              </div>
            </div>

            <div className="mt-4">
              {/* Step 1 */}
              {step === 1 && (
                <div className={`p-4 rounded-lg ${isDark ? 'bg-slate-700/40' : 'bg-slate-100'} text-slate-200`}>Choose Collection or Delivery at the top to start a new order.</div>
              )}

              {/* Step 2: Items */}
              {step === 2 && (
                <div className="mt-3">
                  <div className="flex items-center gap-3 mb-3">
                    <input placeholder="Search products..." value={search} onChange={(e)=>setSearch(e.target.value)} className={`flex-1 px-3 py-2 rounded-lg ${isDark ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border ${isDark ? 'border-slate-600' : 'border-slate-200'}`} />
                    <button onClick={()=>setFilterPanelOpen(p=>!p)} className={`px-3 py-2 rounded-lg ${isDark ? 'bg-slate-700 text-white' : 'bg-slate-200 text-slate-800'}`}><i className="fas fa-filter"></i></button>
                  </div>

                  {/* inline filter panel */}
                  {filterPanelOpen && (
                    <div className={`mb-3 p-3 rounded-md ${isDark ? 'bg-slate-700/40' : 'bg-slate-100'}`}>
                      <div className="flex flex-wrap items-center gap-2">
                        <button onClick={() => { clearFilters(); setFilterPanelOpen(false); }} className="px-3 py-1 rounded bg-slate-200 text-slate-800 text-sm">All</button>
                        {['clear','fish','chips','sausages','extras','chicken','sides','litebites','drinks','children','pies','glutenfree'].map(tag => (
                          <button key={tag} onClick={() => toggleTag(tag)} className={`${selectedTags.includes(tag) ? 'bg-indigo-600 text-white' : (isDark ? 'bg-slate-700 text-white' : 'bg-white text-slate-800')} px-3 py-1 rounded text-sm`}>{tag}</button>
                        ))}
                        <button onClick={() => clearFilters()} className="ml-auto text-sm text-rose-600">Clear</button>
                      </div>
                    </div>
                  )}

                  <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                    {filteredProducts.map(prod => (
                      <div key={prod.id} className={`${isDark ? 'bg-slate-700' : 'bg-white'} rounded-xl p-3 flex items-center gap-3 cursor-pointer card-shadow hover:scale-105`} onClick={() => setShowItemModal(prod)}>
                        <div className="w-12 h-12 rounded-md bg-slate-600 flex items-center justify-center text-sm font-semibold text-white">{prod.name.split(' ').slice(0,2).map(w=>w[0]).join('')}</div>
                        <div className="flex-1">
                          <div className={`${isDark ? 'text-white' : 'text-slate-800'} font-semibold`}>{prod.name}</div>
                          <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'} text-sm`}>{formatCurrency(prod.basePricePence || prod.pricePence)}</div>
                          <div className="mt-1 text-xs">{(prod.tags||[]).map(tag => <span key={tag} className={`inline-block mr-1 px-2 py-0.5 rounded text-xs ${isDark ? 'bg-slate-600 text-slate-200' : 'bg-slate-100 text-slate-600'}`}>{tag}</span>)}</div>
                        </div>
                        <div className={`${isDark ? 'text-slate-200' : 'text-slate-600'}`}><i className="fas fa-plus-circle"></i></div>
                      </div>
                    ))}
                  </div>

                  <div className="mt-4">
                    <h4 className={`${isDark ? 'text-white' : 'text-slate-800'} font-semibold mb-2`}>Current items</h4>
                    {orderItems.length === 0 ? (
                      <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'}`}>No items yet. Tap a product to add.</div>
                    ) : (
                      <div className="space-y-2">
                        {orderItems.map(it => (
                          <div key={it.id} className={`${isDark ? 'bg-slate-700' : 'bg-white'} p-2 rounded-lg flex items-center gap-3 card-shadow`}>
                            <div className="w-10 h-10 rounded bg-slate-600 flex items-center justify-center text-sm font-semibold text-white">{it.name.split(' ').map(s=>s[0]).join('')}</div>
                            <div className="flex-1">
                              <div className={`${isDark ? 'text-white' : 'text-slate-800'} font-medium`}>{it.name}</div>
                              <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'} text-sm`}>{formatCurrency(it.pricePence)} × {it.qty} = <span className="font-semibold">{formatCurrency(it.pricePence * it.qty)}</span></div>
                              {it.options && it.options.length > 0 && (
                                <div className="text-xs mt-1 text-slate-300">
                                  {it.options.map((o, idx) => (
                                    <div key={idx}>{o.choiceLabel ? `${o.label}: ${o.choiceLabel}` : o.label}{o.pricePence ? ` (+${formatCurrency(o.pricePence)})` : ''}</div>
                                  ))}
                                </div>
                              )}
                            </div>
                            <div className="flex items-center gap-2">
                              <button onClick={() => updateQty(it.id, it.qty - 1)} className="px-2 py-1 rounded bg-slate-600 text-white">−</button>
                              <input type="number" value={it.qty} min="1" onChange={(e)=>updateQty(it.id, Math.max(1, parseInt(e.target.value || 1)))} className="w-14 px-2 py-1 rounded bg-slate-800 text-white text-center" />
                              <button onClick={() => updateQty(it.id, it.qty + 1)} className="px-2 py-1 rounded bg-emerald-600 text-white">+</button>
                              <button onClick={() => removeItem(it.id)} className="px-2 py-1 rounded bg-rose-600 text-white"><i className="fas fa-trash"></i></button>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>

                  <div className="flex gap-3 mt-4">
                    <button onClick={() => setStep(1)} className="px-4 py-2 rounded-lg bg-slate-700 text-white">Back</button>

                    {/* Done Editing when editing items */}
                    {editingPart === 'items' && editingOrderId ? (
                      <button onClick={() => doneEditing()} className="px-4 py-2 rounded-lg bg-emerald-600 text-white font-semibold">Done Editing</button>
                    ) : (
                      <button onClick={() => setStep(3)} className="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold">Next: Time</button>
                    )}

                    <button onClick={() => { setOrderItems([]); showToast('Order items cleared'); }} className="ml-auto px-4 py-2 rounded-lg bg-rose-600 text-white">Clear Items</button>
                  </div>
                </div>
              )}

              {/* Step 3: native time picker */}
              {step === 3 && (
                <div className="mt-3">
                  <label className={`block ${isDark ? 'text-slate-200' : 'text-slate-700'} font-medium`}>Preferred {orderType === 'delivery' ? 'delivery' : 'collection'} time</label>
                  <div className="mt-2">
                    <input type="time" step="900" value={orderTime} onChange={(e)=>setOrderTime(e.target.value)} className={`px-3 py-2 rounded-lg ${isDark ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border ${isDark ? 'border-slate-600' : 'border-slate-200'}`} />
                  </div>
                  <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'} text-sm mt-2`}>Choose a time</div>

                  <div className="flex gap-3 mt-4">
                    <button onClick={() => setStep(2)} className="px-4 py-2 rounded-lg bg-slate-700 text-white">Back</button>

                    {/* Done Editing when editing time */}
                    {editingPart === 'time' && editingOrderId ? (
                      <button onClick={() => doneEditing()} className="px-4 py-2 rounded-lg bg-emerald-600 text-white font-semibold">Done Editing</button>
                    ) : (
                      <button onClick={() => setStep(4)} className="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold">Next: Customer</button>
                    )}

                    <button onClick={() => { setOrderTime(''); showToast('Time cleared'); }} className="ml-auto px-4 py-2 rounded-lg bg-rose-600 text-white">Clear Time</button>
                  </div>
                </div>
              )}

              {/* Step 4: Customer info */}
              {step === 4 && (
                <div className="mt-3 space-y-3">
                  <label className={`block ${isDark ? 'text-slate-200' : 'text-slate-700'} font-medium`}>Customer name</label>
                  <input value={customer.name} onChange={(e)=>setCustomer(c=>({...c, name:e.target.value}))} className={`w-full px-3 py-2 rounded-lg ${isDark ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border ${isDark ? 'border-slate-600' : 'border-slate-200'}`} placeholder="e.g. John Smith" />

                  {orderType === 'delivery' && (
                    <>
                      <label className={`block ${isDark ? 'text-slate-200' : 'text-slate-700'} font-medium`}>Address</label>
                      <input value={customer.address} onChange={(e)=>setCustomer(c=>({...c, address:e.target.value}))} className={`w-full px-3 py-2 rounded-lg ${isDark ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border ${isDark ? 'border-slate-600' : 'border-slate-200'}`} placeholder="House number and street" />
                      <div className="grid grid-cols-2 gap-3">
                        <input value={customer.postcode} onChange={(e)=>setCustomer(c=>({...c, postcode:e.target.value}))} placeholder="Postcode" className={`px-3 py-2 rounded-lg ${isDark ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border ${isDark ? 'border-slate-600' : 'border-slate-200'}`} />
                        <input value={customer.phone} onChange={(e)=>setCustomer(c=>({...c, phone:e.target.value}))} placeholder="Phone (optional)" className={`px-3 py-2 rounded-lg ${isDark ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border ${isDark ? 'border-slate-600' : 'border-slate-200'}`} />
                      </div>
                    </>
                  )}

                  <div className="flex gap-3 mt-4">
                    <button onClick={() => setStep(3)} className="px-4 py-2 rounded-lg bg-slate-700 text-white">Back</button>

                   {/* Done Editing when editing customer */}
                  {editingPart === 'customer' && editingOrderId ? (
                    <button
                      onClick={() => doneEditing()}
                      className="px-4 py-2 rounded-lg bg-emerald-600 text-white font-semibold"
                    >
                      Done Editing
                    </button>
                  ) : (
                    <button
                      onClick={() => setStep(5)}
                      className="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold"
                    >
                      Next: Review
                    </button>
                  )}
                  </div>
                </div>
              )}



              {/* Step 5: Review */}
              {step === 5 && (
                <div className="mt-3">
                  <div className={`${isDark ? 'bg-slate-700' : 'bg-white'} rounded-lg p-4`}>
                    <div className="flex items-start justify-between">
                      <div>
                        <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'}`}>Order Type</div>
                        <div className={`${isDark ? 'text-white' : 'text-slate-800'} font-semibold`}>{orderType ? orderType.charAt(0).toUpperCase() + orderType.slice(1) : '—'}</div>
                      </div>
                      <div>
                        <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'}`}>Time</div>
                        <div className={`${isDark ? 'text-white' : 'text-slate-800'} font-semibold`}>{orderTime || '—'}</div>
                      </div>
                    </div>

                    <div className="mt-4">
                      <h4 className={`${isDark ? 'text-white' : 'text-slate-800'} font-semibold`}>Customer</h4>
                      <div className={`${isDark ? 'text-slate-200' : 'text-slate-600'} mt-2`}>
                        <div>{customer.name || '—'}</div>
                        {orderType === 'delivery' && <div className={`${isDark ? 'text-slate-300' : 'text-slate-500'} mt-1`}>{customer.address || '—'} • {customer.postcode || '—'} {customer.phone ? `• ${customer.phone}` : ''}</div>}
                      </div>
                    </div>

                    <div className="mt-4">
                      <h4 className={`${isDark ? 'text-white' : 'text-slate-800'} font-semibold`}>Items</h4>
                      <div className="mt-2 space-y-2">
                        {orderItems.map(it=>(
                          <div key={it.id} className="border-b pb-2">
                            <div className="flex justify-between items-center">
                              <div className={`${isDark ? 'text-slate-100' : 'text-slate-800'}`}>{it.name} × {it.qty}</div>
                              <div className={`${isDark ? 'text-slate-200' : 'text-slate-600'}`}>{formatCurrency(it.pricePence * it.qty)}</div>
                            </div>
                            {it.options && it.options.length > 0 && (
                              <div className="text-xs text-slate-300 mt-1">
                                {it.options.map((o, idx) => (
                                  <div key={idx}>{o.choiceLabel ? `${o.label}: ${o.choiceLabel}` : o.label}{o.pricePence ? ` (+${formatCurrency(o.pricePence)})` : ''}</div>
                                ))}
                              </div>
                            )}
                          </div>
                        ))}
                      </div>

                      {/* Add delivery charge line when delivery order */}
                      {orderType === 'delivery' && (
                        <div className="mt-2 flex justify-between items-center">
                          <div className={`${isDark ? 'text-slate-100' : 'text-slate-800'}`}>Delivery Charge</div>
                          <div className={`${isDark ? 'text-slate-200' : 'text-slate-600'}`}>{formatCurrency(DELIVERY_CHARGE_PENCE)}</div>
                        </div>
                      )}

                      <div className="mt-3 border-t border-slate-700 pt-3 flex justify-between font-semibold">
                        <div>Grand Total</div>
                        <div>{formatCurrency(grandTotalPence)}</div>
                      </div>
                    </div>

                    <div className="flex gap-3 mt-4">
                      <button onClick={() => setStep(4)} className="px-4 py-2 rounded-lg bg-slate-700 text-white">Back</button>
                      <button onClick={() => saveOrder()} className="px-4 py-2 rounded-lg bg-emerald-600 text-white font-semibold">Confirm & Save Order</button>
                      <button onClick={() => clearActiveOrder()} className="ml-auto px-4 py-2 rounded-lg bg-rose-600 text-white">Start New Order</button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        </section>

        {/* RIGHT: History / summary / reset */}
        <aside className="md:col-span-1 space-y-4">
          <div className={`${isDark ? 'bg-slate-800' : 'bg-white'} rounded-2xl p-4 card-shadow`}>
            <div className="flex items-center justify-between">
              <div>
                <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'} text-sm`}>Current Order</div>
                <div className={`${isDark ? 'text-white' : 'text-slate-800'} text-lg font-semibold`}>{orderType ? orderType.toUpperCase() : '—'}</div>
              </div>
              <div className="text-right">
                <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'} text-sm`}>Items</div>
                <div className="font-semibold">{totalItems}</div>
              </div>
            </div>

            <div className="mt-4">
              <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'} text-sm`}>Grand total</div>
              <div className={`text-2xl font-extrabold mt-1 ${isDark ? 'text-white' : 'text-slate-800'}`}>{formatCurrency(grandTotalPence)}</div>
            </div>

            <div className="mt-4 flex gap-2">
              
              <button onClick={confirmResetDay} className="px-3 py-2 rounded-lg bg-rose-600 text-white">Reset Day</button>
            </div>
          </div>

          {/* Pending / Completed */}
          <div className={`${isDark ? 'bg-slate-800' : 'bg-white'} rounded-xl p-3 card-shadow`}>
            <div className="flex items-center justify-between mb-3">
              <h4 className={`${isDark ? 'text-white' : 'text-slate-800'} font-semibold`}>Orders</h4>
              <div className="text-sm">
                <span className="font-medium">{orders.filter(o=>o.status==='pending').length}</span> pending
              </div>
            </div>

            <div className="space-y-2 max-h-52 overflow-auto">
              {orders.filter(o=>o.status==='pending').length === 0 && <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'}`}>No pending orders</div>}
              {orders.filter(o=>o.status==='pending').map(o => (
                <div key={o.id} className={`${isDark ? 'bg-slate-700' : 'bg-slate-50'} p-2 rounded-lg flex items-start justify-between`}>
                  <div>
                    <div className={`${isDark ? 'text-white' : 'text-slate-800'} font-medium`}>{o.customer.name || 'No name'}</div>
                    <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'} text-sm`}>{o.type} • {o.time} • {formatCurrency(o.totalPence)}</div>
                    <div className={`text-slate-300 text-sm mt-1`}>{o.items.map(i=>`${i.qty}×${i.name}${i.options && i.options.length ? ' ('+ i.options.map(op => op.choiceLabel ? `${op.label}:${op.choiceLabel}` : op.label).join('; ') +')' : ''}`).join(', ')}</div>
                  </div>
                  <div className="flex flex-col gap-2">
                    <button onClick={()=>beginView(o.id)} className="px-2 py-1 rounded bg-indigo-600 text-white text-sm">View</button>
                    <button onClick={()=>markComplete(o.id)} className="px-2 py-1 rounded bg-emerald-600 text-white text-sm">Complete</button>

                  </div>
                </div>
              ))}
            </div>

            <div className="mt-3 border-t pt-3">
              <button onClick={()=>setShowCompleted(c=>!c)} className="text-sm text-slate-300">{showCompleted ? 'Hide' : 'Show'} Completed Orders ({orders.filter(o=>o.status==='completed').length})</button>
            </div>

            {showCompleted && (
              <div className="mt-3 space-y-2 max-h-40 overflow-auto">
                {orders.filter(o=>o.status==='completed').length === 0 && <div className="text-slate-400">No completed orders</div>}
                {orders.filter(o=>o.status==='completed').map(o => (
                  <div key={o.id} className={`${isDark ? 'bg-slate-700' : 'bg-slate-50'} p-2 rounded-lg flex items-start justify-between`}>
                    <div>
                      <div className={`${isDark ? 'text-white' : 'text-slate-800'} font-medium`}>{o.customer.name || 'No name'}</div>
                      <div className={`${isDark ? 'text-slate-300' : 'text-slate-600'} text-sm`}>{o.type} • {o.time} • {formatCurrency(o.totalPence)}</div>
                    </div>
                    <div className="flex flex-col gap-2">
                      <button onClick={()=>reopenOrder(o.id)} className="px-2 py-1 rounded bg-slate-600 text-white text-sm">Reopen</button>
                      <button onClick={()=>deleteOrder(o.id)} className="px-2 py-1 rounded bg-rose-600 text-white text-sm">Delete</button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          

        </aside>
      </main>

      {/* Edit choice modal */}
      <Modal open={editChoiceModalOpen} title="Edit order" onClose={() => { setEditChoiceModalOpen(false); setEditingOrderId(null); }}>
        <div>
          <p className="mb-3">Which part would you like to edit?</p>
          <div className="flex gap-2">
            <button onClick={() => chooseEditPart('items')} className="px-3 py-2 rounded bg-indigo-600 text-white">Items</button>
            <button onClick={() => chooseEditPart('time')} className="px-3 py-2 rounded bg-amber-500 text-white">Time</button>
            <button onClick={() => chooseEditPart('customer')} className="px-3 py-2 rounded bg-emerald-600 text-white">Customer Info</button>
            <button onClick={() => { setEditChoiceModalOpen(false); setEditingOrderId(null); }} className="px-3 py-2 rounded bg-slate-700 text-white">Cancel</button>
          </div>
        </div>
      </Modal>

      {/* View Order modal */}
      <Modal open={viewModalOpen} title="View Order" onClose={() => { setViewModalOpen(false); setViewingOrder(null); }}>
        {viewingOrder && (
          <div>
            <p className="mb-2 font-semibold">{viewingOrder.customer.name}</p>
            <p className="text-sm mb-2">{viewingOrder.type.toUpperCase()} • {viewingOrder.time}</p>
            <div className="mb-2">
              {viewingOrder.items.map(it => (
                <div key={it.id} className="flex justify-between text-sm">
                  <div>
                    <div className="font-medium">{it.name} × {it.qty}</div>
                    {it.options && it.options.length > 0 && (
                      <div className="text-xs text-slate-400">
                        {it.options.map((o, idx) => (<div key={idx}>{o.choiceLabel ? `${o.label}: ${o.choiceLabel}` : o.label}{o.pricePence ? ` (+${formatCurrency(o.pricePence)})` : ''}</div>))}
                      </div>
                    )}
                  </div>
                  <div>{formatCurrency(it.pricePence * it.qty)}</div>
                </div>
              ))}
            </div>
            <div className="font-semibold border-t pt-2 mb-3">Total: {formatCurrency(viewingOrder.totalPence)}</div>
            <div className="flex gap-2">
              <button
                onClick={() => {
                  const { jsPDF } = window.jspdf;

                  // layout metrics (mm)
                  const leftX = 4;
                  const rightX = 54;
                  const pageWidth = 58;
                  const paddingBottom = 4;
                  const headerFontSize = 11;
                  const normalFontSize = 9;
                  const totalFontSize = 11;
                  const lineHeight = 5; // mm per line
                  const maxTextWidth = 40; // mm available for item text before wrapping

                  // We'll use a temporary doc to calculate wrapping/line counts.
                  const tmp = new jsPDF({ unit: "mm", format: [pageWidth, 2000] });

                  // helper to count wrapped lines for a piece of text at a particular font size
                  const countWrappedLines = (text, fontSize) => {
                    tmp.setFont("courier", "normal");
                    tmp.setFontSize(fontSize);
                    const wrapped = tmp.splitTextToSize(text, maxTextWidth);
                    return wrapped.length;
                  };

                  // initial y offset for the first line (same y used when rendering)
                  let initialY = 9;
                  let lines = 0;

                  // header lines (we'll render them with headerFontSize / normalFontSize)
                  lines += countWrappedLines("Fish & Chips Shop", headerFontSize);
                  lines += countWrappedLines("------------------------------", normalFontSize);
                  lines += countWrappedLines(`Order Type: ${viewingOrder.type}`, normalFontSize);
                  lines += countWrappedLines(`Time: ${viewingOrder.time}`, normalFontSize);
                  lines += countWrappedLines(`Customer: ${viewingOrder.customer.name}`, normalFontSize);
                  lines += countWrappedLines("------------------------------", normalFontSize);

                  // items — measure wrapped lines for each item (use normalFontSize)
                  viewingOrder.items.forEach(it => {
                    const nameQty = `${it.name} x${it.qty}`;
                    lines += countWrappedLines(nameQty, normalFontSize);
                    if (it.options && it.options.length) {
                      it.options.forEach(o => {
                        lines += countWrappedLines(`  - ${o.choiceLabel ? `${o.label}: ${o.choiceLabel}` : o.label}`, 6);
                      });
                    }
                  });

                  // delivery charge line if applicable
                  if (viewingOrder.type === "delivery") {
                    lines += countWrappedLines("Delivery Charge", normalFontSize);
                  }

                  // separators + total section lines
                  lines += countWrappedLines("------------------------------", normalFontSize);
                  lines += countWrappedLines(`Total: £${(viewingOrder.totalPence / 100).toFixed(2)}`, totalFontSize);
                  lines += countWrappedLines("------------------------------", normalFontSize);

                  // delivery address block (if applicable)
                  if (viewingOrder.type === "delivery") {
                    lines += countWrappedLines("Delivery Address", headerFontSize);
                    lines += countWrappedLines("------------------------------", normalFontSize);
                    lines += countWrappedLines(viewingOrder.customer.name || "", normalFontSize);
                    lines += countWrappedLines(viewingOrder.customer.address || "", normalFontSize);
                    lines += countWrappedLines(viewingOrder.customer.postcode || "", normalFontSize);
                    if (viewingOrder.customer.phone) lines += countWrappedLines(`Phone: ${viewingOrder.customer.phone}`, normalFontSize);
                  }

                  // calculate exact required height
                  const contentHeight = lines * lineHeight;
                  const pageHeight = Math.max(30, initialY + contentHeight + paddingBottom);

                  // Create final doc with exact height
                  const doc = new jsPDF({
                    orientation: "portrait",
                    unit: "mm",
                    format: [pageWidth, pageHeight],
                  });

                  // rendering helpers
                  let y = initialY;
                  const addText = (txt, size = normalFontSize, bold = false, align = "left") => {
                    doc.setFontSize(size);
                    doc.setFont("courier", bold ? "bold" : "normal");
                    const x = align === "center" ? pageWidth / 2 : leftX;
                    doc.text(txt, x, y, { align: align === "center" ? "center" : "left" });
                    y += lineHeight;
                  };

                  // Header (render)
                  addText("Fish & Chips Shop", headerFontSize, true, "center");
                  addText("------------------------------", normalFontSize, false, "center");
                  addText(`Order Type: ${viewingOrder.type}`);
                  addText(`Time: ${viewingOrder.time}`);
                  addText(`Customer: ${viewingOrder.customer.name}`);
                  addText("------------------------------", normalFontSize, false, "center");

                  // Items (render with wrapping + right-aligned line totals)
                  viewingOrder.items.forEach(it => {
                    const nameQty = `${it.name} x${it.qty}`;
                    doc.setFontSize(normalFontSize);
                    doc.setFont("courier", "normal");
                    const wrapped = doc.splitTextToSize(nameQty, maxTextWidth); // uses same doc so widths are consistent
                    const lineTotal = `£${((it.pricePence * it.qty) / 100).toFixed(2)}`;

                    wrapped.forEach((t, idx) => {
                      if (idx < wrapped.length - 1) {
                        doc.text(t, leftX, y);
                        y += lineHeight;
                      } else {
                        // last wrapped line: print name and right-aligned price
                        doc.text(t, leftX, y);
                        doc.text(lineTotal, rightX, y, { align: "right" });
                        y += lineHeight;
                      }
                    });

                    if (it.options && it.options.length) {
  it.options.forEach(o => {
    let optText = "";

    // Handle Salt & Vinegar specifically
    if (o.groupId === "saltvinegar") {
      switch (o.choiceId) {
        case "sv":
          optText = "add salt and vinegar";
          break;
        case "salt":
          optText = "add salt";
          break;
        case "vinegar":
          optText = "add vinegar";
          break;
        case "none":
          optText = "";
          break;
        default:
          optText = "";
      }
    } else {
      // Default for all other options
      optText = o.choiceLabel
        ? `${o.label}: ${o.choiceLabel}`
        : o.label;
    }

    if (optText) {
  doc.setFontSize(6);

  // Remove any embedded (£...) text that comes from o.choiceLabel
  const cleanedText = optText.replace(/\(£[0-9.]+\)/g, "").trim();

  // Build the display line
  let optionDisplay = `  - ${cleanedText}`;

  // If the option changes the price, show only the final total (no parentheses)
  if (o.pricePence && o.pricePence > 0) {
    const totalForItem = (it.pricePence * it.qty) / 100;
    optionDisplay += ` £${totalForItem.toFixed(2)}`;
  }

  doc.text(optionDisplay, leftX, y);
  y += lineHeight;
}


  });
}


                  });

                  // Delivery charge
                  if (viewingOrder.type === "delivery") {
                    doc.text("Delivery Charge", leftX, y);
                    doc.text("£3.00", rightX, y, { align: "right" });
                    y += lineHeight;
                  }

                  // Totals
                  addText("------------------------------", normalFontSize, false, "center");
                  addText(`Total: £${(viewingOrder.totalPence / 100).toFixed(2)}`, totalFontSize, true, "center");
                  addText("------------------------------", normalFontSize, false, "center");

                  // Delivery address block (if delivery) — ends the document
                  if (viewingOrder.type === "delivery") {
                    addText("Delivery Address", headerFontSize, true, "left");
                    addText("------------------------------", normalFontSize, false, "center");
                    addText(viewingOrder.customer.name || "");
                    addText(viewingOrder.customer.address || "");
                    addText(viewingOrder.customer.postcode || "");
                    if (viewingOrder.customer.phone) addText(`Phone: ${viewingOrder.customer.phone}`);
                  }

                  // Output PDF — page height was set before writing, so no trimming needed
                  const pdfBlob = doc.output("blob");
                  const pdfUrl = URL.createObjectURL(pdfBlob);
                  window.open(pdfUrl, "_blank");
                }}

                className="px-4 py-2 rounded bg-slate-700 text-white font-semibold"
              >
                Download PDF Receipt
              </button>





              <button
                onClick={() => {
                  setViewModalOpen(false);
                  setEditingOrderId(viewingOrder.id);
                  setEditChoiceModalOpen(true);
                }}
                className="px-4 py-2 rounded bg-indigo-600 text-white font-semibold"
              >
                Edit / View Details
              </button>
            </div>
          </div>
        )}
      </Modal>

      {/* Item add modal (options-aware) */}
      <Modal open={!!showItemModal} title={showItemModal ? `Add ${showItemModal.name}` : ''} onClose={()=>setShowItemModal(null)} wide>
        {showItemModal && <AddItemForm product={showItemModal} onCancel={()=>setShowItemModal(null)} onAdd={(qty, selectedOptions)=>{ addOrUpdateItem(showItemModal, qty, selectedOptions); setShowItemModal(null); }} />}
      </Modal>

      {/* Reset day modal */}
      <Modal open={resetModalOpen} title="Reset day?" onClose={()=>setResetModalOpen(false)}>
        <div>
          <p>Are you sure you want to reset the day? This will clear all pending and completed orders.</p>
          <div className="mt-4 flex gap-2">
            <button onClick={()=>setResetModalOpen(false)} className="px-4 py-2 rounded bg-slate-700 text-white">Cancel</button>
            <button onClick={()=>doResetDay()} className="px-4 py-2 rounded bg-rose-600 text-white">Reset Day</button>
          </div>
        </div>
      </Modal>

      {/* New order confirm modal (red accent) */}
      <Modal open={newOrderConfirmOpen} title="Start a new order?" onClose={cancelStartNew}>
        <div>
          <p>This will clear your current order in progress.</p>
          <div className="mt-4 flex gap-2">
            <button onClick={cancelStartNew} className="px-4 py-2 rounded bg-slate-700 text-white">Cancel</button>
            <button onClick={confirmStartNew} className="px-4 py-2 rounded bg-rose-600 text-white">Start New</button>
          </div>
        </div>
      </Modal>

      <Toast open={toast.open} text={toast.text} actionLabel={toast.action ? 'Undo' : null} onAction={toast.action ? (() => { if (toast.action) toast.action(); setToast({ open:false, text:'', action:null }); }) : null} />

    </div>
  );
}

/* ---------- AddItemForm: options-aware ---------- */
function AddItemForm({ product, onCancel, onAdd }) {
  const [qty, setQty] = useState(1);

  // selectedOptions: map groupId -> selected structure
  const initialSelection = {};
  (product.options || []).forEach(opt => {
    if (opt.type === 'single') {
      initialSelection[opt.groupId] = opt.defaultChoice || (opt.choices && opt.choices[0] && opt.choices[0].id);
    } else if (opt.type === 'boolean') {
      initialSelection[opt.groupId] = false;
    } else {
      initialSelection[opt.groupId] = null;
    }
  });
  const [selection, setSelection] = useState(initialSelection);

  const inc = () => setQty(q => q + 1);
  const dec = () => setQty(q => Math.max(1, q - 1));

  // build selectedOptions array with labels & pricePence
  const buildSelectedOptions = () => {
    const arr = [];
    (product.options || []).forEach(opt => {
      const sel = selection[opt.groupId];
      if (opt.type === 'boolean') {
        if (sel) arr.push({ groupId: opt.groupId, label: opt.label, pricePence: opt.pricePence || 0 });
      } else if (opt.type === 'single') {
        const choice = (opt.choices || []).find(c => c.id === sel);
        if (choice && choice.id !== 'no') {
          arr.push({ groupId: opt.groupId, label: opt.label, choiceId: choice.id, choiceLabel: choice.label, pricePence: choice.pricePence || 0 });
        }
      }
    });
    return arr;
  };

  // compute preview unit price
  const computeUnitPrice = () => {
    const base = product.basePricePence || product.pricePence || 0;
    const opts = buildSelectedOptions();
    const sum = opts.reduce((s,o)=> s + (o.pricePence || 0), 0);
    return base + sum;
  };

  return (
    <div>
      <div className="flex items-center gap-4">
        <div className="w-16 h-16 rounded-lg bg-slate-700 flex items-center justify-center text-white text-xl font-bold">{product.name.split(' ').slice(0,2).map(w=>w[0]).join('')}</div>
        <div>
          <div className="font-semibold text-slate-900 dark:text-slate-100">{product.name}</div>
          <div className="text-slate-500 dark:text-slate-300">{formatCurrency(product.basePricePence || product.pricePence)}</div>
        </div>
      </div>

      {product.options && product.options.length > 0 && (
        <div className="mt-4 space-y-3">
          <div className="font-semibold">Options</div>
          <div className="space-y-2">
            {product.options.map((opt, idx) => (
              <div key={idx} className="p-2 rounded border">
                <div className="font-medium text-sm">{opt.label}</div>
                <div className="mt-2">
                  {opt.type === 'boolean' && (
                    <label className="inline-flex items-center gap-2">
                      <input type="checkbox" checked={!!selection[opt.groupId]} onChange={(e)=>setSelection(s=>({...s, [opt.groupId]: e.target.checked}))} />
                      <span className="text-sm">{opt.label}{opt.pricePence ? ` (+${formatCurrency(opt.pricePence)})` : ''}</span>
                    </label>
                  )}

                  {opt.type === 'single' && (
                    <div className="flex flex-wrap gap-2">
                      {(opt.choices || []).map(ch => (
                        <label key={ch.id} className={`px-3 py-1 rounded border ${selection[opt.groupId] === ch.id ? 'bg-indigo-600 text-white' : ''}`}>
                          <input type="radio" name={`${product.id}_${opt.groupId}`} value={ch.id} checked={selection[opt.groupId] === ch.id} onChange={()=>setSelection(s=>({...s, [opt.groupId]: ch.id}))} className="hidden" />
                          <span className="text-sm">{ch.label}{ch.pricePence ? ` (+${formatCurrency(ch.pricePence)})` : ''}</span>
                        </label>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      <div className="mt-4 flex items-center gap-3">
        <button onClick={dec} className="px-3 py-2 rounded bg-slate-600 text-white text-lg">−</button>
        <input type="number" min="1" value={qty} onChange={(e)=>setQty(Math.max(1, parseInt(e.target.value || 1)))} className="w-20 px-2 py-2 rounded bg-white/5 text-black text-center" />
        <button onClick={inc} className="px-3 py-2 rounded bg-emerald-600 text-white text-lg">+</button>

        <div className="ml-auto text-right">
          <div className="text-xs text-slate-300">Unit</div>
          <div className="font-semibold">{formatCurrency(computeUnitPrice())}</div>
        </div>
      </div>

      <div className="mt-4 flex gap-2">
        <button onClick={onCancel} className="px-4 py-2 rounded-lg bg-slate-700 text-white">Cancel</button>
        <button onClick={()=> onAdd(qty, buildSelectedOptions()) } className="px-4 py-2 rounded-lg bg-emerald-600 text-white font-semibold">Add {qty} — {formatCurrency(computeUnitPrice() * qty)}</button>
      </div>
    </div>
  );
}

/* ---------- Render ---------- */
ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
