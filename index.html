<button
  onClick={() => {
    const { jsPDF } = window.jspdf;

    const lineHeight = 5;
    let y = 9;

    // --- measure how many lines the receipt needs ---
    let lineCount = 6; // header lines
    lineCount += viewingOrder.items.length; // one per item
    lineCount += 8; // total + delivery address lines + spacing

    const estHeight = y + lineCount * lineHeight + 10; // padding at bottom
    const pageHeight = Math.max(30, estHeight); // min 30 mm so tiny orders still fit

    // --- create PDF with exact required height ---
    const doc = new jsPDF({
      orientation: "portrait",
      unit: "mm",
      format: [58, pageHeight],
    });

    const addLine = (text = "", size = 10, bold = false, align = "left") => {
      doc.setFontSize(size);
      doc.setFont("courier", bold ? "bold" : "normal");
      doc.text(text, align === "center" ? 29 : 4, y, { align });
      y += lineHeight;
    };

    // ---- HEADER ----
    addLine("Fish & Chips Shop", 11, true, "center");
    addLine("------------------------------", 10, false, "center");
    addLine(`Order Type: ${viewingOrder.type}`);
    addLine(`Time: ${viewingOrder.time}`);
    addLine(`Customer: ${viewingOrder.customer.name}`);
    addLine("------------------------------");

    // ---- ITEMS ----
    viewingOrder.items.forEach((it) => {
      addLine(`${it.name}  x${it.qty}`, 11);
    });

    // ---- TOTAL ----
    addLine("------------------------------");
    addLine(
      `Total: Â£${(viewingOrder.totalPence / 100).toFixed(2)}`,
      11,
      true,
      "center"
    );
    addLine("------------------------------", 10, false, "center");

    // ---- DELIVERY ADDRESS ----
    if (viewingOrder.type === "delivery") {
      addLine("Delivery Address", 11, true);
      addLine("------------------------------");
      addLine(viewingOrder.customer.name);
      addLine(viewingOrder.customer.address);
      addLine(viewingOrder.customer.postcode);
      if (viewingOrder.customer.phone)
        addLine(`Phone: ${viewingOrder.customer.phone}`);
    }

    // ---- OPEN PDF in new tab (mobile-safe) ----
    const pdfBlob = doc.output("blob");
    const pdfUrl = URL.createObjectURL(pdfBlob);
    window.open(pdfUrl, "_blank");
  }}
  className="px-4 py-2 rounded bg-slate-700 text-white font-semibold"
>
  Download PDF Receipt
</button>
